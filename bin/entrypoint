#!/bin/bash

set -e

if [ "$1" = "export_statistics_to_json" ]; then
    # this is triggered by Airflow
    jetstream export-statistics-to-json
elif [ "$1" = "rerun_config_changed" ]; then
    # this is triggered by the jetstream-config repo
    jetstream rerun_config_changed
elif [ "$1" = "get_active_experiments" ]; then
    # argo
    jetstream get_active_experiments "${@:2}"
elif [ "$1" = "analyse_experiment" ]; then
    # argo
    jetstream analyse_experiment "${@:2}"
elif [ "$1" = "rerun_experiment" ]; then
    # argo
    jetstream rerun_experiment "${@:2}"
else
    # this is triggered by Airflow
    jetstream --log_to_bigquery run "$@"
    jetstream --log_to_bigquery rerun_config_changed
fi
